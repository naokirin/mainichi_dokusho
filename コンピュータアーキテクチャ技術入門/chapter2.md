# 第2章 プロセッサ技術

## 2.1 プロセッサの命令セットアーキテクチャ

* 命令セットアーキテクチャは以下を規定する
  - プロセッサがどのような「実行環境」と「命令」を持つか
  - プロセッサが命令を実行することでどのような結果が生じるか

### 実行環境

* 実行環境は「レジスタ」と「メモリ空間」からなる

#### レジスタ

* 汎用レジスタ: 処理をするデータを格納する汎用のレジスタ（群）
  - 整数用レジスタ群と浮動小数点数用レジスタ群を別個に持つことが多い
  - CELLプロセッサのSPEは整数、浮動小数点数両方を格納できる汎用レジスタを持つ
* 特定用途レジスタ: 特定の仕事のためのレジスタ（群）
  - IP（Instruction Pointer）: 次に実行する命令のアドレスを記憶する
  - Statusレジスタ（フラグレジスタ）: 様々な整数演算の状態を記憶する（主に条件分岐などに用いる）
  - FP Status レジスタ: 様々な浮動小数点数演算の状態を記憶する

#### メモリ空間

* メモリ空間: 各アドレスに1バイトの情報を記憶してRead/Writeできるように抽象化したもの
  - メモリ空間の大きさは命令セットアーキテクチャのアドレスの最大値であり、実メモリに依存しない
  - 32ビット命令アーキテクチャなら0〜2^32 -1、64ビット命令アーキテクチャなら0〜2^64 -1の範囲になる
  - [アドレス空間 - Wikipedia](https://ja.wikipedia.org/wiki/アドレス空間)
  - [仮想記憶](https://ja.wikipedia.org/wiki/仮想記憶)

#### スーパーバイザモードとユーザモード

* スーパーバイザモード: 実行環境に含まれるすべての資源を利用できるモード
* ユーザモード: 汎用レジスタ、Statusレジスタ、IPレジスタ以外の特権レジスタが利用できないモード
* OSはスーパーバイザモードで実行され、以下の様なことを行う
  - 特権命令を利用した特権レジスタの操作
  - 各プロセスが利用するメモリアドレスの範囲の管理
  - 入出力装置を管理してプログラムの出力が混ざらないようにする

#### 命令群の分類

* 3アドレス命令と2アドレス命令
  - 3アドレス命令: 命令の中のオペランド（A+BにおけるAやB）の格納されているアドレスと結果を格納するアドレスを個別に指定する命令
  - 2アドレス命令: 命令の中のオペランドの格納されているアドレスの1つに結果を格納することで2つのアドレスのみ指定する命令
  - IntelやAMDのx86命令アーキテクチャは2アドレス命令
* 固定長命令と可変長命令
  - 固定長命令: 命令によって命令のビット数が変わる命令、Intelのx86命令アーキテクチャなどがこれに当たる
  - 可変長命令: 命令によらずビット数が固定の命令、RISCスタイルの命令アーキテクチャなどがこれにあたる
  - Intelのx86命令アーキテクチャは、演算命令でメモリへのRead/Writeを直接行える特徴を持つ
  - RISCでは、メモリアクセスはロード命令、ストア命令のみで行い、演算命令では汎用レジスタのみ扱う

#### メモリアドレスの指定法

* メモリアドレスを個々に指定する方法
  - 欠点として命令が長くなる
* 整数レジスタにメモリアドレスを格納して、命令ではレジスタの番号を使う方法
  - 毎回レジスタの内容を書き換える必要がある
* 整数レジスタにベースアドレスを格納して、命令はベースアドレスから実際のアドレスまでのオフセットで指定してアクセスする
